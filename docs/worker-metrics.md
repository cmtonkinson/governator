# Worker Metrics Tracking

Governator tracks execution metrics for retrospective analysis. Workers can optionally report wall time and token utilization in their `exit.json` file.

## Exit Status Schema

The `exit.json` file written to `$GOVERNATOR_WORKER_STATE_DIR/exit.json` supports the following fields:

### Required Fields
- `exit_code` (int): Process exit code (0 for success)
- `finished_at` (string): ISO 8601 timestamp of completion
- `pid` (int): Process ID

### Optional Metrics Fields
- `duration_ms` (int64): Wall time in milliseconds for this stage
- `tokens_prompt` (int): Input/prompt tokens consumed by the LLM
- `tokens_response` (int): Output/completion tokens generated by the LLM
- `tokens_total` (int): Total tokens (prompt + response)

## Example

```json
{
  "exit_code": 0,
  "finished_at": "2026-02-03T10:30:45Z",
  "pid": 12345,
  "duration_ms": 45230,
  "tokens_prompt": 1250,
  "tokens_response": 830,
  "tokens_total": 2080
}
```

## Metrics Accumulation

Governator accumulates metrics across all stages (work, test, review, resolve) into the task's `metrics` field in `index.json`:

```json
{
  "id": "T-001",
  "state": "merged",
  "metrics": {
    "duration_ms": 180000,
    "tokens_prompt": 5000,
    "tokens_response": 3200,
    "tokens_total": 8200
  }
}
```

## CLI Integration

### Codex
Codex should report metrics in exit.json when available.

### Claude Code
Claude CLI should report metrics in exit.json when available.

### Gemini
Gemini CLI should report metrics in exit.json when available.

## Notes

- All metrics fields are optional for backwards compatibility
- Metrics are only accumulated on successful stage completion
- If a worker doesn't report metrics, they will be zero/empty
- Metrics are purely for retrospective analysis and don't affect execution flow
